{"version":3,"file":"BearbyAccount.js","sourceRoot":"","sources":["../../../src/bearbyWallet/BearbyAccount.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  EventFilterParam,\n  web3,\n  DatastoreEntryInputParam,\n  JsonRPCResponse,\n  ExecuteBytecodeParams,\n} from '@hicaru/bearby.js';\nimport { errorHandler } from '../errors/utils/errorHandler';\nimport { operationType } from '../utils/constants';\nimport {\n  Address,\n  CallSCParams,\n  DEPLOYER_BYTECODE,\n  DeploySCParams,\n  EventFilter,\n  formatNodeStatusObject,\n  Mas,\n  MAX_GAS_CALL,\n  Network,\n  NodeStatusInfo,\n  Operation,\n  OperationOptions,\n  OperationStatus,\n  Provider,\n  ReadSCData,\n  ReadSCParams,\n  SignedData,\n  SmartContract,\n  StorageCost,\n  strToBytes,\n  bytesToStr,\n  rpcTypes,\n  JsonRpcPublicProvider,\n  ExecuteScParams,\n  populateDatastore,\n  ExecuteSCReadOnlyParams,\n  ExecuteSCReadOnlyResult,\n} from '@massalabs/massa-web3';\nimport { networkInfos } from './utils/network';\nimport { WalletName } from '../wallet';\nimport isEqual from 'lodash.isequal';\nimport { uint8ArrayToBase64 } from '../utils/base64';\n\nlet jsonClient: JsonRpcPublicProvider;\n\nexport class BearbyAccount implements Provider {\n  public constructor(public address: string) {}\n\n  get accountName(): string {\n    return this.address;\n  }\n\n  get providerName(): string {\n    return WalletName.Bearby;\n  }\n\n  // public async connect() {\n  //   try {\n  //     await web3.wallet.connect();\n  //   } catch (ex) {\n  //     console.log('Bearby connection error: ', ex);\n  //   }\n  // }\n\n  private async getClient(): Promise<JsonRpcPublicProvider> {\n    if (!jsonClient) {\n      const network = await networkInfos();\n      jsonClient = (\n        network.name === 'mainnet'\n          ? JsonRpcPublicProvider.mainnet()\n          : JsonRpcPublicProvider.buildnet()\n      ) as JsonRpcPublicProvider;\n    }\n    return jsonClient;\n  }\n\n  public async balance(final = false): Promise<bigint> {\n    // // TODO: check if we need to connect every time\n    // await this.connect();\n\n    try {\n      const res = await web3.massa.getAddresses(this.address);\n\n      if (res.error || !res.result) {\n        throw new Error(res.error?.message || 'Bearby getAddresses error');\n      }\n\n      const { final_balance, candidate_balance } = res.result[0];\n\n      return Mas.fromString(final ? final_balance : candidate_balance);\n    } catch (error) {\n      const errorMessage = `An unexpected error occurred while fetching the account balance: ${error.message}.`;\n\n      throw new Error(errorMessage);\n    }\n  }\n\n  public async balanceOf(\n    addresses: string[],\n    final?: boolean,\n  ): Promise<{ address: string; balance: bigint }[]> {\n    const res = await web3.massa.getAddresses(...addresses);\n    if (res.error || !res.result) {\n      throw new Error(res.error?.message || 'Bearby getAddresses error');\n    }\n\n    return res.result.map((addressInfo) => {\n      const { final_balance, candidate_balance } = addressInfo;\n      return {\n        address: addressInfo.address,\n        balance: Mas.fromString(final ? final_balance : candidate_balance),\n      };\n    });\n  }\n\n  public async networkInfos(): Promise<Network> {\n    return networkInfos();\n  }\n\n  public async sign(data: Uint8Array | string): Promise<SignedData> {\n    // await this.connect();\n\n    if (data instanceof Uint8Array) {\n      data = bytesToStr(data);\n    }\n\n    try {\n      const signature = await web3.wallet.signMessage(data);\n\n      return {\n        publicKey: signature.publicKey,\n        signature: signature.signature,\n      };\n    } catch (error) {\n      throw errorHandler(operationType.Sign, error);\n    }\n  }\n\n  public async buyRolls(\n    amount: bigint,\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _opts?: OperationOptions,\n  ): Promise<Operation> {\n    // await this.connect();\n    try {\n      const operationId = await web3.massa.buyRolls(amount.toString());\n      return new Operation(this, operationId);\n    } catch (error) {\n      throw errorHandler(operationType.BuyRolls, error);\n    }\n  }\n\n  public async sellRolls(\n    amount: bigint,\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _opts?: OperationOptions,\n  ): Promise<Operation> {\n    // await this.connect();\n    try {\n      const operationId = await web3.massa.sellRolls(amount.toString());\n      return new Operation(this, operationId);\n    } catch (error) {\n      throw errorHandler(operationType.SellRolls, error);\n    }\n  }\n\n  public async transfer(\n    to: Address | string,\n    amount: bigint,\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _opts?: OperationOptions,\n  ): Promise<Operation> {\n    // await this.connect();\n\n    try {\n      const operationId = await web3.massa.payment(\n        amount.toString(),\n        to.toString(),\n      );\n\n      return new Operation(this, operationId);\n    } catch (error) {\n      throw errorHandler(operationType.SendTransaction, error);\n    }\n  }\n\n  private async minimalFee(): Promise<bigint> {\n    const { minimalFee } = await this.networkInfos();\n    return minimalFee;\n  }\n\n  public async callSC(params: CallSCParams): Promise<Operation> {\n    // await this.connect();\n\n    const args = params.parameter ?? new Uint8Array();\n    const unsafeParameters =\n      args instanceof Uint8Array ? args : Uint8Array.from(args.serialize());\n\n    const fee = params.fee ?? (await this.minimalFee());\n\n    let maxGas = params.maxGas;\n    if (!maxGas) {\n      const client = await this.getClient();\n      maxGas = await client.getGasEstimation({\n        ...params,\n        caller: this.address,\n      });\n    }\n\n    try {\n      const operationId = await web3.contract.call({\n        // TODO: add bigint support in bearby.js\n        maxGas: Number(maxGas),\n        coins: Number(params.coins || 0),\n        fee: Number(fee),\n        targetAddress: params.target,\n        functionName: params.func,\n        unsafeParameters,\n      });\n      return new Operation(this, operationId);\n    } catch (error) {\n      throw errorHandler(operationType.CallSC, error);\n    }\n  }\n\n  public async readSC(params: ReadSCParams): Promise<ReadSCData> {\n    if (params.maxGas && params.maxGas > MAX_GAS_CALL) {\n      throw new Error(\n        `Gas amount ${params.maxGas} exceeds the maximum allowed ${MAX_GAS_CALL}.`,\n      );\n    }\n\n    const args = params.parameter ?? new Uint8Array();\n    const unsafeParameters =\n      args instanceof Uint8Array ? args : Uint8Array.from(args.serialize());\n\n    const fee = params?.fee ?? (await this.minimalFee());\n    const caller = params.caller ?? this.address;\n\n    try {\n      // const res = await web3.contract.readSmartContract({\n      //   // TODO: add bigint support in bearby.js\n      //   maxGas: Number(params.maxGas),\n      //   coins: Number(params.coins),\n      //   fee: Number(fee),\n      //   targetAddress: params.target,\n      //   targetFunction: params.func,\n      //   // TODO: add unsafeParameters to bearby.js\n      //   // https://github.com/bearby-wallet/bearby-web3/pull/18\n      //   parameter: unsafeParameters as any,\n      // });\n\n      // console.log('bearby readSC res', res[0]);\n      // const data = res[0].result[0];\n\n      // return {\n      //   value: data.result.Ok ? Uint8Array.from(data.result.Ok): new Uint8Array(),\n      //   info: {\n      //     error: data.result.Error,\n      //     events: data.output_events.map((event: SCEvent) => ({\n      //       data: event.data,\n      //       context: event.context,\n      //     })),\n      //     gasCost: data.gas_cost,\n      //   },\n      // };\n\n      // Temp implementation to remove when bearby.js is fixed\n      const client = await this.getClient();\n      const readOnlyParams = {\n        ...params,\n        caller,\n        fee,\n        parameter: unsafeParameters,\n      };\n      return client.readSC(readOnlyParams);\n    } catch (error) {\n      throw new Error(\n        `An error occurred while reading the smart contract: ${error.message}`,\n      );\n    }\n  }\n\n  public async deploySC(params: DeploySCParams): Promise<SmartContract> {\n    try {\n      const fee = Number(params.fee ?? (await this.minimalFee()));\n      const coins = params.coins ?? 0n;\n      const maxCoins =\n        params.maxCoins ??\n        StorageCost.smartContractDeploy(params.byteCode.length) + coins;\n\n      const args = params.parameter ?? new Uint8Array();\n      const parameters = args instanceof Uint8Array ? args : args.serialize();\n\n      let maxGas = params.maxGas;\n      if (!maxGas) {\n        const client = await this.getClient();\n\n        const datastore = populateDatastore([\n          {\n            data: params.byteCode,\n            args: parameters,\n            coins,\n          },\n        ]);\n\n        maxGas = await client.executeSCGasEstimation({\n          ...params,\n          byteCode: DEPLOYER_BYTECODE,\n          datastore,\n          caller: this.address,\n        });\n      }\n\n      const bearbyParams = {\n        maxCoins,\n        maxGas,\n        coins,\n        fee,\n        contractDataBase64: uint8ArrayToBase64(params.byteCode),\n        deployerBase64: uint8ArrayToBase64(DEPLOYER_BYTECODE),\n        unsafeParameters: parameters,\n      };\n\n      const operationId = await web3.contract.deploy(bearbyParams);\n\n      const operation = new Operation(this, operationId);\n\n      const deployedAddress = await operation.getDeployedAddress(\n        params.waitFinalExecution,\n      );\n\n      return new SmartContract(this, deployedAddress);\n    } catch (error) {\n      console.error('Error deploying smart contract:', error);\n      throw new Error(`Failed to deploy smart contract: ${error.message}`);\n    }\n  }\n\n  public async executeSC(params: ExecuteScParams): Promise<Operation> {\n    const fee = params.fee ?? (await this.minimalFee());\n    let maxGas = params.maxGas;\n    if (!maxGas) {\n      const client = await this.getClient();\n      maxGas = await client.executeSCGasEstimation({\n        ...params,\n        caller: this.address,\n      });\n    }\n\n    const args: ExecuteBytecodeParams = {\n      maxCoins: params.maxCoins ?? 0n,\n      maxGas,\n      fee,\n      bytecodeBase64: uint8ArrayToBase64(params.byteCode),\n      datastore: params.datastore ?? new Map<Uint8Array, Uint8Array>(),\n    };\n\n    const operationId = await web3.contract.executeBytecode(args);\n\n    return new Operation(this, operationId);\n  }\n\n  async executeSCReadOnly(\n    params: ExecuteSCReadOnlyParams,\n  ): Promise<ExecuteSCReadOnlyResult> {\n    try {\n      const client = await this.getClient();\n      return client.executeSCReadOnly(params);\n    } catch (error) {\n      throw new Error(\n        `Error during readonly smart contract bytecode execution: ${error}`,\n      );\n    }\n  }\n\n  public async getOperationStatus(opId: string): Promise<OperationStatus> {\n    try {\n      const res = await web3.massa.getOperations(opId);\n\n      if (res.error || !res.result) {\n        throw new Error(res.error?.message || 'Bearby getOperations error');\n      }\n      const op = res.result[0];\n      if (op.op_exec_status === null) {\n        if (op.is_operation_final === null) {\n          return OperationStatus.NotFound;\n        }\n        throw new Error('unexpected status');\n      }\n\n      if (op.in_pool) {\n        return OperationStatus.PendingInclusion;\n      }\n\n      if (!op.is_operation_final) {\n        return op.op_exec_status\n          ? OperationStatus.SpeculativeSuccess\n          : OperationStatus.SpeculativeError;\n      }\n\n      return op.op_exec_status\n        ? OperationStatus.Success\n        : OperationStatus.Error;\n    } catch (error) {\n      throw new Error(\n        `An error occurred while fetching the operation status: ${error.message}`,\n      );\n    }\n  }\n\n  public async getEvents(filter: EventFilter): Promise<rpcTypes.OutputEvents> {\n    const formattedFilter: EventFilterParam = {\n      start: filter.start,\n      end: filter.end,\n      emitter_address: filter.smartContractAddress,\n      original_caller_address: filter.callerAddress,\n      original_operation_id: filter.operationId,\n      is_final: filter.isFinal,\n      is_error: filter.isError,\n    };\n\n    try {\n      /* \n        Currently getFilteredSCOutputEvent is supposed to return a JsonRPCResponseFilteredSCOutputEvent object.\n        But in practice it's returning an array of JsonRPCResponse<rpcTypes.OutputEvents> objects.\n      */\n      const res = (await web3.contract.getFilteredSCOutputEvent(\n        formattedFilter,\n      )) as JsonRPCResponse<rpcTypes.OutputEvents>[];\n\n      if (res?.[0]?.error) throw res[0].error;\n      return res?.[0]?.result ?? [];\n    } catch (error) {\n      throw new Error(\n        `An error occurred while fetching the operation status: ${error.message}`,\n      );\n    }\n  }\n\n  public async getNodeStatus(): Promise<NodeStatusInfo> {\n    const status = await web3.massa.getNodesStatus();\n    if (status.error || !status.result) {\n      throw new Error(status.error?.message || 'Bearby getNodeStatus error');\n    }\n    // remove \"as any\" when this PR is merged https://github.com/bearby-wallet/bearby-web3/pull/28\n    return formatNodeStatusObject(status.result as any);\n  }\n\n  public async getStorageKeys(\n    address: string,\n    filter: Uint8Array | string = new Uint8Array(),\n    final = true,\n  ): Promise<Uint8Array[]> {\n    const res = await web3.massa.getAddresses(address);\n    if (res.error || !res.result) {\n      throw new Error(res.error?.message || 'Bearby getStorageKeys error');\n    }\n\n    const addressInfo = res.result[0];\n    const keys = final\n      ? addressInfo.final_datastore_keys\n      : addressInfo.candidate_datastore_keys;\n\n    const filterBytes: Uint8Array =\n      typeof filter === 'string' ? strToBytes(filter) : filter;\n\n    return keys\n      .filter(\n        (key) =>\n          !filter.length ||\n          isEqual(\n            Uint8Array.from(key.slice(0, filterBytes.length)),\n            filterBytes,\n          ),\n      )\n      .map((d) => Uint8Array.from(d));\n  }\n\n  public async readStorage(\n    address: string,\n    keys: Uint8Array[] | string[],\n    final = true,\n  ): Promise<Uint8Array[]> {\n    try {\n      const input: DatastoreEntryInputParam[] = keys.map((key) => ({\n        key,\n        address,\n      }));\n      const data = await web3.contract.getDatastoreEntries(...input);\n      const resultArray = data[0]['result'];\n      const dataArray = final\n        ? resultArray.map((d) => Uint8Array.from(d.final_value))\n        : resultArray.map((d) => Uint8Array.from(d.candidate_value));\n      return dataArray;\n    } catch (error) {\n      throw new Error(\n        `An error occurred while reading the storage: ${error.message}`,\n      );\n    }\n  }\n}\n"]}