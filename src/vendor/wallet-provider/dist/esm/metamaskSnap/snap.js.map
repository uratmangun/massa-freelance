{"version":3,"file":"snap.js","sourceRoot":"","sources":["../../../src/metamaskSnap/snap.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,aAAa,EAAE,MAAM,UAAU,CAAC;AAGzC,MAAM,CAAC,MAAM,iBAAiB,GAAG,KAAK,EACpC,QAAgC,EACL,EAAE;IAC7B,MAAM,GAAG,GAAG,MAAM,QAAQ,CAAC,OAAO,CAAC;QACjC,MAAM,EAAE,iBAAiB;KAC1B,CAAC,CAAC;IACH,IAAI,CAAC,GAAG,EAAE;QACR,MAAM,IAAI,KAAK,CAAC,kDAAkD,CAAC,CAAC;KACrE;IACD,OAAO,GAAG,CAAC;AACb,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,gBAAgB,GAAG,KAAK,EACnC,QAAgC,EAChC,OAAgB,EACW,EAAE;IAC7B,IAAI;QACF,MAAM,KAAK,GAAG,MAAM,iBAAiB,CAAC,QAAQ,CAAC,CAAC;QAEhD,OAAO,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAC9B,CAAC,IAAI,EAAE,EAAE,CACP,IAAI,CAAC,EAAE,KAAK,aAAa,IAAI,CAAC,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,KAAK,OAAO,CAAC,CACtE,CAAC;KACH;IAAC,OAAO,KAAK,EAAE;QACd,sCAAsC;QACtC,OAAO,CAAC,KAAK,CAAC,8BAA8B,EAAE,KAAK,CAAC,CAAC;QACrD,OAAO,SAAS,CAAC;KAClB;AACH,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,WAAW,GAAG,KAAK,EAC9B,QAAgC,EACd,EAAE;IACpB,MAAM,IAAI,GAAG,MAAM,gBAAgB,CAAC,QAAQ,CAAC,CAAC;IAC9C,OAAO,CAAC,CAAC,IAAI,CAAC;AAChB,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,WAAW,GAAG,KAAK,EAC9B,QAAgC,EAChC,SAA8C,EAAE,EAChD,EAAE;IACF,OAAO,QAAQ,CAAC,OAAO,CAAC;QACtB,MAAM,EAAE,qBAAqB;QAC7B,MAAM,EAAE;YACN,CAAC,aAAa,CAAC,EAAE,MAAM;SACxB;KACF,CAAC,CAAC;AACL,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,cAAc,GAAG,KAAK,EAAE,QAAgC,EAAE,EAAE;IACvE,OAAO,QAAQ,CAAC,OAAO,CAAC;QACtB,MAAM,EAAE,mBAAmB;QAC3B,MAAM,EAAE,EAAE,MAAM,EAAE,aAAa,EAAE,OAAO,EAAE,EAAE,MAAM,EAAE,eAAe,EAAE,EAAE;KACxE,CAAC,CAAC;AACL,CAAC,CAAC","sourcesContent":["import type { MetaMaskInpageProvider } from '@metamask/providers';\n\nimport { MASSA_SNAP_ID } from './config';\nimport { type GetSnapsResponse, Snap } from './types';\n\nexport const getInstalledSnaps = async (\n  provider: MetaMaskInpageProvider,\n): Promise<GetSnapsResponse> => {\n  const res = await provider.request({\n    method: 'wallet_getSnaps',\n  });\n  if (!res) {\n    throw new Error('metamask wallet_getSnaps returned empty response');\n  }\n  return res;\n};\n\nexport const getMassaSnapInfo = async (\n  provider: MetaMaskInpageProvider,\n  version?: string,\n): Promise<Snap | undefined> => {\n  try {\n    const snaps = await getInstalledSnaps(provider);\n\n    return Object.values(snaps).find(\n      (snap) =>\n        snap.id === MASSA_SNAP_ID && (!version || snap.version === version),\n    );\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error('Failed to get installed snap', error);\n    return undefined;\n  }\n};\n\nexport const isConnected = async (\n  provider: MetaMaskInpageProvider,\n): Promise<boolean> => {\n  const snap = await getMassaSnapInfo(provider);\n  return !!snap;\n};\n\nexport const connectSnap = async (\n  provider: MetaMaskInpageProvider,\n  params: Record<'version' | string, unknown> = {},\n) => {\n  return provider.request({\n    method: 'wallet_requestSnaps',\n    params: {\n      [MASSA_SNAP_ID]: params,\n    },\n  });\n};\n\nexport const showPrivateKey = async (provider: MetaMaskInpageProvider) => {\n  return provider.request({\n    method: 'wallet_invokeSnap',\n    params: { snapId: MASSA_SNAP_ID, request: { method: 'showSecretKey' } },\n  });\n};\n"]}