{"version":3,"file":"MetamaskAccount.js","sourceRoot":"","sources":["../../../src/metamaskSnap/MetamaskAccount.ts"],"names":[],"mappings":"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","sourcesContent":["import { MetaMaskInpageProvider } from '@metamask/providers';\nimport {\n  Address,\n  CallSCParams,\n  DeploySCParams,\n  EventFilter,\n  Network,\n  NodeStatusInfo,\n  Operation,\n  OperationOptions,\n  OperationStatus,\n  Provider,\n  ReadSCData,\n  ReadSCParams,\n  SignedData,\n  SmartContract,\n  rpcTypes,\n  ExecuteScParams,\n  ExecuteSCReadOnlyParams,\n  ExecuteSCReadOnlyResult,\n} from '@massalabs/massa-web3';\nimport { WalletName } from '../wallet';\nimport { errorHandler } from '../errors/utils/errorHandler';\nimport { operationType } from '../utils/constants';\nimport { networkInfos, getClient } from './utils/network';\nimport {\n  buyRolls,\n  callSC,\n  deploySC,\n  executeSC,\n  getBalance,\n  sellRolls,\n  signMessage,\n  transfer,\n} from './services';\nimport type {\n  BuyRollsParams,\n  SellRollsParams,\n  TransferParams,\n  CallSCParams as MMCallSCParams,\n  DeploySCParams as MMDeploySCParams,\n  ExecuteSCParams as MMExecuteSCParams,\n} from '@massalabs/metamask-snap';\n\nexport class MetamaskAccount implements Provider {\n  constructor(\n    public readonly address: string,\n    private readonly provider: MetaMaskInpageProvider,\n  ) {}\n\n  get accountName(): string {\n    return this.address;\n  }\n\n  get providerName(): string {\n    return WalletName.Metamask;\n  }\n\n  async balance(final = false): Promise<bigint> {\n    const { finalBalance, candidateBalance } = await getBalance(this.provider, {\n      address: this.address,\n    });\n    return BigInt(final ? finalBalance : candidateBalance);\n  }\n\n  async balanceOf(\n    addresses: string[],\n    final = false,\n  ): Promise<{ address: string; balance: bigint }[]> {\n    const client = await getClient(this.provider);\n    return client.balanceOf(addresses, final);\n  }\n\n  async networkInfos(): Promise<Network> {\n    return networkInfos(this.provider);\n  }\n\n  async sign(inData: Uint8Array | string): Promise<SignedData> {\n    try {\n      const data = typeof inData === 'string' ? inData : Array.from(inData);\n      const { publicKey, signature } = await signMessage(this.provider, {\n        data,\n      });\n\n      return {\n        publicKey,\n        signature,\n      };\n    } catch (error) {\n      throw errorHandler(operationType.Sign, error);\n    }\n  }\n\n  private async handleRollOperation(\n    operation: 'buy' | 'sell',\n    amount: bigint,\n    opts?: OperationOptions,\n  ): Promise<Operation> {\n    try {\n      const params: BuyRollsParams | SellRollsParams = {\n        amount: amount.toString(),\n      };\n      if (opts?.fee) {\n        params.fee = opts?.fee.toString();\n      }\n\n      const { operationId } = await (operation === 'buy'\n        ? buyRolls(this.provider, params)\n        : sellRolls(this.provider, params));\n\n      return new Operation(this, operationId);\n    } catch (error) {\n      throw errorHandler(\n        operation === 'buy' ? operationType.BuyRolls : operationType.SellRolls,\n        error,\n      );\n    }\n  }\n\n  async buyRolls(amount: bigint, opts?: OperationOptions): Promise<Operation> {\n    return this.handleRollOperation('buy', amount, opts);\n  }\n\n  async sellRolls(amount: bigint, opts?: OperationOptions): Promise<Operation> {\n    return this.handleRollOperation('sell', amount, opts);\n  }\n\n  async transfer(\n    to: Address | string,\n    amount: bigint,\n    opts?: OperationOptions,\n  ): Promise<Operation> {\n    try {\n      const params: TransferParams = {\n        amount: amount.toString(),\n        recipientAddress: to.toString(),\n      };\n      if (opts?.fee) {\n        params.fee = opts?.fee.toString();\n      }\n      const { operationId } = await transfer(this.provider, params);\n\n      return new Operation(this, operationId);\n    } catch (error) {\n      throw errorHandler(operationType.SendTransaction, error);\n    }\n  }\n\n  async callSC(params: CallSCParams): Promise<Operation> {\n    try {\n      const callSCparams: MMCallSCParams = {\n        functionName: params.func,\n        at: params.target,\n      };\n      if (params.parameter) {\n        callSCparams.args =\n          params.parameter instanceof Uint8Array\n            ? Array.from(params.parameter)\n            : Array.from(params.parameter.serialize());\n      }\n      if (params.coins) {\n        callSCparams.coins = params.coins.toString();\n      }\n      if (params.maxGas) {\n        callSCparams.maxGas = params.maxGas.toString();\n      }\n      if (params.fee) {\n        callSCparams.fee = params.fee.toString();\n      }\n\n      const { operationId } = await callSC(this.provider, callSCparams);\n\n      return new Operation(this, operationId);\n    } catch (error) {\n      throw errorHandler(operationType.CallSC, error);\n    }\n  }\n\n  async readSC(params: ReadSCParams): Promise<ReadSCData> {\n    try {\n      const client = await getClient(this.provider);\n      const readOnlyParams = {\n        ...params,\n        caller: params.caller ?? this.address,\n      };\n      return client.readSC(readOnlyParams);\n    } catch (error) {\n      throw new Error(`Smart contract read failed: ${error.message}`);\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  async deploySC(params: DeploySCParams): Promise<SmartContract> {\n    try {\n      const deployParams: MMDeploySCParams = {\n        bytecode: Array.from(params.byteCode),\n      };\n      if (params.parameter) {\n        deployParams.args = Array.from(\n          params.parameter instanceof Uint8Array\n            ? params.parameter\n            : params.parameter.serialize(),\n        );\n      }\n      if (params.coins) {\n        deployParams.coins = params.coins.toString();\n      }\n      if (params.maxGas) {\n        deployParams.maxGas = params.maxGas.toString();\n      }\n      if (params.fee) {\n        deployParams.fee = params.fee.toString();\n      }\n      if (params.maxCoins) {\n        deployParams.maxCoins = params.maxCoins.toString();\n      }\n\n      const { operationId } = await deploySC(this.provider, deployParams);\n      const op = new Operation(this, operationId);\n      const deployedAddress = await op.getDeployedAddress(\n        params.waitFinalExecution,\n      );\n\n      return new SmartContract(this, deployedAddress);\n    } catch (error) {\n      throw errorHandler(operationType.DeploySC, error);\n    }\n  }\n\n  async getOperationStatus(opId: string): Promise<OperationStatus> {\n    const client = await getClient(this.provider);\n    return client.getOperationStatus(opId);\n  }\n\n  async getEvents(filter: EventFilter): Promise<rpcTypes.OutputEvents> {\n    const client = await getClient(this.provider);\n    return client.getEvents(filter);\n  }\n\n  async getNodeStatus(): Promise<NodeStatusInfo> {\n    const client = await getClient(this.provider);\n    return client.getNodeStatus();\n  }\n\n  async getStorageKeys(\n    address: string,\n    filter: Uint8Array | string = new Uint8Array(),\n    final = true,\n  ): Promise<Uint8Array[]> {\n    const client = await getClient(this.provider);\n    return client.getStorageKeys(address, filter, final);\n  }\n\n  async readStorage(\n    address: string,\n    keys: Uint8Array[] | string[],\n    final = true,\n  ): Promise<(Uint8Array | null)[]> {\n    const client = await getClient(this.provider);\n    return client.readStorage(address, keys, final);\n  }\n\n  async executeSC(params: ExecuteScParams): Promise<Operation> {\n    try {\n      const executeParams: MMExecuteSCParams = {\n        bytecode: Array.from(params.byteCode),\n      };\n      if (params.datastore) {\n        executeParams.datastore = Array.from(params.datastore.entries()).map(\n          ([key, value]) => ({\n            key: Array.from(key),\n            value: Array.from(value),\n          }),\n        );\n      }\n\n      if (params.maxGas) {\n        executeParams.maxGas = params.maxGas.toString();\n      }\n      if (params.fee) {\n        executeParams.fee = params.fee.toString();\n      }\n      if (params.maxCoins) {\n        executeParams.maxCoins = params.maxCoins.toString();\n      }\n\n      const { operationId } = await executeSC(this.provider, executeParams);\n      return new Operation(this, operationId);\n    } catch (error) {\n      throw errorHandler(operationType.ExecuteSC, error);\n    }\n  }\n\n  async executeSCReadOnly(\n    params: ExecuteSCReadOnlyParams,\n  ): Promise<ExecuteSCReadOnlyResult> {\n    try {\n      const readOnlyParams = {\n        ...params,\n        caller: params.caller ?? this.address,\n      };\n\n      const client = await getClient(this.provider);\n      return client.executeSCReadOnly(readOnlyParams);\n    } catch (error) {\n      throw new Error(\n        `Error during readonly smart contract bytecode execution: ${error}`,\n      );\n    }\n  }\n}\n"]}